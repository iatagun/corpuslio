{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if success %}Yeni Åžifre Belirle{% else %}SÄ±fÄ±rlama HatasÄ±{% endif %} - CorpusLIO</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        .status-icon {
            width: 110px;
            height: 110px;
            margin: 0 auto 30px;
            background: {% if success %}linear-gradient(135deg, #f093fb 0%, #f5576c 100%){% else %}linear-gradient(135deg, #eb3349 0%, #f45c43 100%){% endif %};
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.5s ease-out;
            box-shadow: 0 4px 20px rgba({% if success %}245, 87, 108{% else %}235, 51, 73{% endif %}, 0.3);
        }
        .status-icon span {
            font-size: 64px;
            color: white;
        }
        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .password-strength {
            margin-top: 8px;
            font-size: 12px;
        }
        .strength-bar {
            height: 4px;
            border-radius: 2px;
            background: #e0e0e0;
            margin-top: 6px;
            overflow: hidden;
        }
        .strength-fill {
            height: 100%;
            transition: all 0.3s;
            width: 0%;
        }
        .strength-weak { background: #eb3349; width: 25%; }
        .strength-fair { background: #ffc107; width: 50%; }
        .strength-good { background: #38ef7d; width: 75%; }
        .strength-strong { background: #11998e; width: 100%; }
    </style>
</head>
<body class="auth-page">
    <div class="auth-container">
        <div class="auth-card" style="max-width: 900px; display:flex; gap:24px; align-items:stretch; margin: 0 auto;">
            {% if success %}
            <!-- Valid token - show password reset form -->
            <div class="left" style="flex:1; padding:40px 36px;">
                <h1>
                    <span class="material-icons" style="font-size: 40px; vertical-align: middle; color: #f5576c;">lock_reset</span>
                    Yeni Åžifre Belirle
                </h1>
                <p>Merhaba <strong>{{ user.username }}</strong>, hesabÄ±nÄ±z iÃ§in yeni bir ÅŸifre oluÅŸturun.</p>
                <div class="muted">GÃ¼Ã§lÃ¼ bir ÅŸifre seÃ§tiÄŸinizden emin olun</div>
            </div>

            <div class="right" style="flex:1; min-width:360px;">
                {% if messages %}
                    {% for message in messages %}
                        <div class="error-message">{{ message }}</div>
                    {% endfor %}
                {% endif %}

                <form method="post" class="auth-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="password1">
                            <span class="material-icons" style="font-size: 18px; vertical-align: middle;">lock</span>
                            Yeni Åžifre
                        </label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input 
                                type="password" 
                                id="password1" 
                                name="password1" 
                                required 
                                autofocus
                                style="flex: 1;"
                                minlength="8"
                            >
                            <button type="button" id="togglePassword1" class="btn btn-outline">GÃ¶ster</button>
                        </div>
                        <div class="password-strength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strengthBar"></div>
                            </div>
                            <div id="strengthText" style="margin-top: 6px; color: var(--text-secondary);"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="password2">
                            <span class="material-icons" style="font-size: 18px; vertical-align: middle;">lock_outline</span>
                            Yeni Åžifre (Tekrar)
                        </label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input 
                                type="password" 
                                id="password2" 
                                name="password2" 
                                required
                                style="flex: 1;"
                                minlength="8"
                            >
                            <button type="button" id="togglePassword2" class="btn btn-outline">GÃ¶ster</button>
                        </div>
                    </div>

                    <div style="background: rgba(102, 126, 234, 0.05); border-left: 4px solid #667eea; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">
                            <span class="material-icons" style="font-size: 18px; vertical-align: middle; color: #667eea;">info</span>
                            <strong>Åžifre gereksinimleri:</strong><br>
                            â€¢ En az 8 karakter<br>
                            â€¢ En az 1 bÃ¼yÃ¼k harf<br>
                            â€¢ En az 1 kÃ¼Ã§Ã¼k harf<br>
                            â€¢ En az 1 rakam
                        </p>
                    </div>

                    <div class="actions">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <span class="material-icons" style="font-size: 18px; vertical-align: middle;">check_circle</span>
                            Åžifreyi DeÄŸiÅŸtir
                        </button>
                    </div>
                </form>
            </div>

            {% else %}
            <!-- Invalid token - show error -->
            <div class="verification-content" style="flex:1; max-width:650px; margin: 0 auto; text-align: center; padding: 40px 20px;">
                <div class="status-icon">
                    <span class="material-icons">error</span>
                </div>

                <h1 style="font-size: 26px; color: var(--text-primary); margin-bottom: 16px; font-weight: 700;">
                    Åžifre SÄ±fÄ±rlama HatasÄ±
                </h1>

                <p style="font-size: 15px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 16px;">
                    {{ message|default:"SÄ±fÄ±rlama linki geÃ§ersiz veya sÃ¼resi dolmuÅŸ olabilir." }}
                </p>

                <div style="background: rgba(235, 51, 73, 0.05); border: 1px solid rgba(235, 51, 73, 0.2); border-left: 4px solid #eb3349; padding: 20px; border-radius: 8px; margin: 24px 0; text-align: left;">
                    <p style="margin: 0; font-size: 14px; color: var(--text-secondary); display: flex; align-items: flex-start; gap: 10px;">
                        <span class="material-icons" style="font-size: 20px; color: #eb3349;">warning</span>
                        <span>
                            Åžifre sÄ±fÄ±rlama linki <strong>1 saat</strong> geÃ§erlidir. 
                            SÃ¼re dolmuÅŸsa veya link kullanÄ±lmÄ±ÅŸsa, yeni bir sÄ±fÄ±rlama talebi oluÅŸturabilirsiniz.
                        </span>
                    </p>
                </div>

                <div style="margin-top: 32px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                    <a href="{% url 'corpus:password_reset_request' %}" style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 14px 28px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 15px;">
                        <span class="material-icons" style="font-size: 18px;">refresh</span>
                        Yeni SÄ±fÄ±rlama Linki GÃ¶nder
                    </a>
                    <a href="{% url 'corpus:login' %}" style="display: inline-flex; align-items: center; gap: 6px; background: transparent; color: var(--text-primary); border: 2px solid var(--border-color); padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px;">
                        <span class="material-icons" style="font-size: 18px;">login</span>
                        GiriÅŸ SayfasÄ±na DÃ¶n
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Password toggle
            const pwd1 = document.getElementById('password1');
            const pwd2 = document.getElementById('password2');
            const toggle1 = document.getElementById('togglePassword1');
            const toggle2 = document.getElementById('togglePassword2');

            if (toggle1 && pwd1) {
                toggle1.addEventListener('click', function() {
                    if (pwd1.type === 'password') {
                        pwd1.type = 'text';
                        toggle1.textContent = 'Gizle';
                    } else {
                        pwd1.type = 'password';
                        toggle1.textContent = 'GÃ¶ster';
                    }
                });
            }

            if (toggle2 && pwd2) {
                toggle2.addEventListener('click', function() {
                    if (pwd2.type === 'password') {
                        pwd2.type = 'text';
                        toggle2.textContent = 'Gizle';
                    } else {
                        pwd2.type = 'password';
                        toggle2.textContent = 'GÃ¶ster';
                    }
                });
            }

            // Password strength meter
            if (pwd1) {
                pwd1.addEventListener('input', function() {
                    const password = pwd1.value;
                    const strengthBar = document.getElementById('strengthBar');
                    const strengthText = document.getElementById('strengthText');
                    
                    if (!password) {
                        strengthBar.className = 'strength-fill';
                        strengthText.textContent = '';
                        return;
                    }

                    let score = 0;
                    let feedback = [];

                    // Length
                    if (password.length >= 8) score += 25;
                    else feedback.push('En az 8 karakter');

                    // Uppercase
                    if (/[A-Z]/.test(password)) score += 25;
                    else feedback.push('bÃ¼yÃ¼k harf');

                    // Lowercase
                    if (/[a-z]/.test(password)) score += 25;
                    else feedback.push('kÃ¼Ã§Ã¼k harf');

                    // Digit
                    if (/\d/.test(password)) score += 25;
                    else feedback.push('rakam');

                    // Special char (bonus)
                    if (/[!@#$%^&*(),.?":{}|<>_\-+=\[\]\\\/~`]/.test(password)) score += 10;

                    // Update bar
                    strengthBar.className = 'strength-fill';
                    if (score < 40) {
                        strengthBar.classList.add('strength-weak');
                        strengthText.textContent = 'ðŸ”´ ZayÄ±f ÅŸifre' + (feedback.length ? ' - Eksik: ' + feedback.join(', ') : '');
                        strengthText.style.color = '#eb3349';
                    } else if (score < 70) {
                        strengthBar.classList.add('strength-fair');
                        strengthText.textContent = 'ðŸŸ¡ Orta ÅŸifre' + (feedback.length ? ' - Eksik: ' + feedback.join(', ') : '');
                        strengthText.style.color = '#ffc107';
                    } else if (score < 100) {
                        strengthBar.classList.add('strength-good');
                        strengthText.textContent = 'ðŸŸ¢ Ä°yi ÅŸifre';
                        strengthText.style.color = '#38ef7d';
                    } else {
                        strengthBar.classList.add('strength-strong');
                        strengthText.textContent = 'âœ… GÃ¼Ã§lÃ¼ ÅŸifre!';
                        strengthText.style.color = '#11998e';
                    }
                });
            }
        });
    </script>
</body>
</html>
