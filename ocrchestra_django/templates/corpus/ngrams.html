{% extends "corpus/base.html" %}

{% block title %}N-gram Analizi - {{ document.filename }}{% endblock %}

{% block content %}
<div class="analysis-header">
    <h2>üî§ N-gram & Kolokasyon Analizi</h2>
    <p class="document-meta">{{ document.filename }}</p>
</div>

<!-- N-gram Type Selector -->
<div class="card">
    <div class="btn-group">
        <a href="?type=bigram" class="btn btn-small {% if ngram_type == 'bigram' %}active{% endif %}">Bigrams
            (2-gram)</a>
        <a href="?type=trigram" class="btn btn-small {% if ngram_type == 'trigram' %}active{% endif %}">Trigrams
            (3-gram)</a>
    </div>
</div>

<!-- Top N-grams -->
<div class="card">
    <h3>üìä En Sƒ±k {{ ngram_type|title }}lar (Top 50)</h3>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>N-gram</th>
                <th>Frekans</th>
            </tr>
        </thead>
        <tbody>
            {% for ngram, count in top_ngrams %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td class="ngram-cell">{{ ngram|join:" " }}</td>
                <td><strong>{{ count }}</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- POS Patterns -->
<div class="card">
    <h3>üè∑Ô∏è En Sƒ±k POS {{ ngram_type|title }} Kalƒ±plarƒ±</h3>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>POS Kalƒ±bƒ±</th>
                <th>Frekans</th>
            </tr>
        </thead>
        <tbody>
            {% for pattern, count in pos_patterns %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                    {% for pos in pattern %}
                    <span class="pos-tag">{{ pos }}</span>
                    {% endfor %}
                </td>
                <td><strong>{{ count }}</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Collocation Search -->
<div class="card">
    <h3>üîç Kolokasyon Ara</h3>
    <form method="GET">
        <input type="hidden" name="type" value="{{ ngram_type }}">
        <div class="form-row">
            <input type="text" name="word" value="{{ search_word }}" placeholder="Kelime girin..." class="form-control"
                style="flex: 1;">
            <button type="submit" class="btn">Ara</button>
        </div>
    </form>

    {% if collocations %}
    <h4 style="margin-top: 1.5rem;">"{{ search_word }}" i√ßin kolokasyonlar:</h4>
    <table style="margin-top: 1rem;">
        <thead>
            <tr>
                <th>Kolokat</th>
                <th>Frekans</th>
                <th>MI Score</th>
                <th>T-Score</th>
            </tr>
        </thead>
        <tbody>
            {% for col in collocations %}
            <tr>
                <td><strong>{{ col.collocate }}</strong></td>
                <td>{{ col.frequency }}</td>
                <td>{{ col.mutual_information|floatformat:2 }}</td>
                <td>{{ col.t_score|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif search_word %}
    <p style="margin-top: 1rem; color: #94a3b8;">Kolokasyon bulunamadƒ±.</p>
    {% endif %}
</div>

<style>
    .btn-group {
        display: flex;
        gap: 0.5rem;
    }

    .btn.active {
        background: linear-gradient(135deg, #14b8a6, #0d9488);
    }

    .ngram-cell {
        font-family: 'JetBrains Mono', monospace;
        color: #14b8a6;
    }

    .form-row {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
</style>
{% endblock %}